# This project requires Python 3.


# Ensure you have the proper system-level libraries.
apt-get install g++  libpcre3-dev zlib1g-dev libssl-dev python-dev swig libfreetype6 libfreetype6-dev libjpeg8-dev libjpeg8 libzzip-dev libxml2-dev libxslt-dev python3 python3-dev

#On 64 bit
apt-get install lib32z1


sudo apt-key adv --keyserver keyserver.ubuntu.com --recv 7F0CEB10
echo "deb http://downloads-distro.mongodb.org/repo/debian-sysvinit dist 10gen" >> /etc/apt/sources.list

apt-get update
apt-get install mongodb-10gen


cd /usr/local/src
wget http://nginx.org/download/nginx-1.0.2.tar.gz
tar -zxvf nginx-1.0.2.tar.gz
cd nginx-1.0.2
wget http://www.grid.net.ru/nginx/download/nginx_upload_module-2.2.0.tar.gz
tar -zxvf nginx_upload_module-2.2.0.tar.gz
git clone https://github.com/mdirolf/nginx-gridfs.git
cd nginx-gridfs
git submodule init
git submodule update
cd ..
./configure --add-module=/usr/local/src/nginx-1.0.2/nginx_upload_module-2.2.0 --add-module=/usr/local/src/nginx-1.0.2/nginx-gridfs --with-http_ssl_module  --prefix=/opt/nginx
make
make install


mkdir /opt/uploads
chmod 777 /opt/uploads/

cd /opt
git clone git@github.com:e1ven/Pluric.git

cd /opt/Pluric/nginx
cp nginx.conf /opt/nginx/conf/


cd /opt/Pluric/libs/distribute-0.6.24/
python3 distribute_setup.py


cd /opt/Pluric/libs/Cython-0.15.1
python3 setup.py install

cd /opt/Pluric/libs/Mako-0.5.0
python3 setup.py install

cd /opt/Pluric/lib/PyTomCrypt
make sources
python3 setup.py build
python3 setup.py install

cd /opt/Pluric/libs/tornado-2.1.1
python3 setup.py install


mkdir -p /usr/local/share/GeoIP/
cp /opt/Pluric/libs/GeoIPCity.dat /usr/local/share/GeoIP/GeoIPCity.dat

cd /opt/Pluric/libs/pygeoip-0.2.2
python3 setup.py install


cd /opt/Pluric/libs/Markdown-2.1.0 
# 2to3 has already been run on git version
# If you redownload, re-run it.
python3 setup.py install


cd /opt/Pluric/libs/pymongo3-1.9b1/
python3 setup.py install


cd /opt/Pluric/libs/postmarkup-1.1.4/
# Use my modified version
python3 setup.py install



cd /opt/Pluric/libs/pil-py3k
# Using Python3 version from https://github.com/sloonz/pil-py3k
python3 setup.py install


cd /opt/Pluric/libs/lxml-2.3/
python3 setup.py build
python3 setup.py install

cd /opt/Pluric/libs/BeautifulSoup-4.0b
python3 setup.py install


cd /opt/Pluric/libs/pycrypto-2.4.1
./configure
python3 setup.py install


echo "/usr/bin/python /opt/Pluric/topiclist.py" > /etc/cron.hourly/generatetopics

ln -s /opt/Pluric/libs/pluric /etc/init.d/

cd /opt/Pluric/
python ./generateNginx.py 

/etc/init.d/mongodb start
/opt/nginx/sbin/nginx

/etc/init.d/pluric start

